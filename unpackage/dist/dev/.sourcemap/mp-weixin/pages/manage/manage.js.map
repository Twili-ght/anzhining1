{"version":3,"file":"manage.js","sources":["pages/manage/manage.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWFuYWdlL21hbmFnZS52dWU"],"sourcesContent":["<template>\r\n\t<view class=\"content\">\r\n\t\t<view class=\"u-demo-block\">\r\n\t\t\t<!-- 表头 -->\r\n\t\t\t<view class=\"tr th\">\r\n\t\t\t\t<view class=\"td\">姓名</view>\r\n\t\t\t\t<view class=\"td\">年级</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<!-- 表体 -->\r\n\t\t\t<scroll-view scroll-y class=\"table-body\">\r\n\t\t\t\t<view class=\"tr\" v-for=\"item in tableData\" :key=\"item._id\">\r\n\t\t\t\t\t<view class=\"td checkbox\">\r\n\t\t\t\t\t\t<checkbox :checked=\"checkedIds.includes(item._id)\" @tap=\"toggleRow(item)\" />\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"td\">{{ item.nickname }}</view>\r\n\t\t\t\t\t<view class=\"td\">{{ item.grade }}</view>\r\n\t\t\t\t</view>\r\n\t\t\t</scroll-view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 底部按钮 -->\r\n\t\t<view class=\"footer-box\">\r\n\t\t\t<up-button type=\"error\" shape=\"circle\" text=\"删除\" :custom-style=\"customStyle\" @click=\"handleDelete\" />\r\n\t\t\t<up-button type=\"primary\" shape=\"circle\" text=\"刷新\" :custom-style=\"customStyle\" @click=\"getTableData\" />\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref,\r\n\t\treactive,\r\n\t\tcomputed,\r\n\t\tonMounted\r\n\t} from 'vue'\r\n\r\n\t/* 表格数据 */\r\n\tconst tableData = ref([])\r\n\r\n\t/* 选中行 id */\r\n\tconst checkedIds = ref([])\r\n\r\n\t/* 底部按钮样式 */\r\n\tconst customStyle = reactive({\r\n\t\twidth: '30%'\r\n\t})\r\n\r\n\t/* 是否全选 */\r\n\tconst isAllChecked = computed(() => {\r\n\t\treturn (\r\n\t\t\ttableData.value.length > 0 &&\r\n\t\t\tcheckedIds.value.length === tableData.value.length\r\n\t\t)\r\n\t})\r\n\r\n\t/* 单行选择 */\r\n\tconst toggleRow = (row) => {\r\n\t\tconst index = checkedIds.value.indexOf(row._id)\r\n\t\tif (index > -1) {\r\n\t\t\tcheckedIds.value.splice(index, 1)\r\n\t\t} else {\r\n\t\t\tcheckedIds.value.push(row._id)\r\n\t\t}\r\n\t}\r\n\r\n\t/* 全选 / 取消全选 */\r\n\tconst toggleAll = () => {\r\n\t\tif (isAllChecked.value) {\r\n\t\t\tcheckedIds.value = []\r\n\t\t} else {\r\n\t\t\tcheckedIds.value = tableData.value.map(item => item._id)\r\n\t\t}\r\n\t}\r\n\r\n\t/* 删除 */\r\n\tconst handleDelete = async () => {\r\n\t\tif (!checkedIds.value.length) {\r\n\t\t\treturn uni.showToast({\r\n\t\t\t\ttitle: '请先选择要删除的用户',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tuni.showModal({\r\n\t\t\ttitle: '确认删除',\r\n\t\t\tcontent: `确定删除 ${checkedIds.value.length} 个用户吗？`,\r\n\t\t\tsuccess: async (res) => {\r\n\t\t\t\tif (!res.confirm) return\r\n\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '删除中...'\r\n\t\t\t\t})\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst result = await uniCloud.callFunction({\r\n\t\t\t\t\t\tname: 'Delete',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\tids: checkedIds.value\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t\tif (result.result?.code === 200) {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '删除成功'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tcheckedIds.value = []\r\n\t\t\t\t\t\tgetTableData()\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: result.result?.msg || '删除失败',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '服务器错误',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t/* 查询数据 */\r\n\tconst getTableData = async () => {\r\n\t\tuni.showLoading({\r\n\t\t\ttitle: '加载中...'\r\n\t\t})\r\n\t\ttry {\r\n\t\t\tconst res = await uniCloud.callFunction({\r\n\t\t\t\tname: 'queryCollection',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tcollectionName: 'user',\r\n\t\t\t\t\tpage: 1,\r\n\t\t\t\t\tpageSize: 300,\r\n\t\t\t\t\torderBy: [\r\n\t\t\t\t\t\t['create_time', 'desc']\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\ttableData.value = res.result?.data || []\r\n\t\t} catch (e) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '加载失败',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t} finally {\r\n\t\t\tuni.hideLoading()\r\n\t\t}\r\n\t}\r\n\r\n\tonMounted(getTableData)\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t@import \"index.scss\";\r\n\r\n\t.content {\r\n\t\tpadding: 24rpx;\r\n\t}\r\n\r\n\t.u-demo-block {\r\n\t\t// border: 2rpx solid #8c8c8c;\r\n\t\tborder-radius: 8rpx;\r\n\t\toverflow: hidden;\r\n\t}\r\n\r\n\t/* 表头 / 行 */\r\n\t.tr {\r\n\t\tdisplay: flex;\r\n\t}\r\n\r\n\t.th {\r\n\t\tbackground: #f5f5f5;\r\n\t\tfont-weight: bold;\r\n\t}\r\n\r\n\t/* 单元格 */\r\n\t.td {\r\n\t\tflex: 1;\r\n\t\tpadding: 16rpx;\r\n\t\t// border-right: 1rpx solid #8c8c8c;\r\n\t\tborder-bottom: 1rpx solid #8c8c8c;\r\n\t\ttext-align: center;\r\n\t\tbox-sizing: border-box;\r\n\t}\r\n\r\n\t.checkbox {\r\n\t\tflex: 0 0 80rpx;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t/* 表体滚动 */\r\n\t.table-body {\r\n\t\tmax-height: 600rpx;\r\n\t}\r\n</style>","import MiniProgramPage from 'E:/桌面/anzhining/abc/pages/manage/manage.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","reactive","computed","uni","uniCloud","onMounted"],"mappings":";;;;;;;;;;;;;AAsCC,UAAM,YAAYA,cAAG,IAAC,EAAE;AAGxB,UAAM,aAAaA,cAAG,IAAC,EAAE;AAGzB,UAAM,cAAcC,cAAAA,SAAS;AAAA,MAC5B,OAAO;AAAA,IACT,CAAE;AAGoBC,kBAAAA,SAAS,MAAM;AACnC,aACC,UAAU,MAAM,SAAS,KACzB,WAAW,MAAM,WAAW,UAAU,MAAM;AAAA,IAE/C,CAAE;AAGD,UAAM,YAAY,CAAC,QAAQ;AAC1B,YAAM,QAAQ,WAAW,MAAM,QAAQ,IAAI,GAAG;AAC9C,UAAI,QAAQ,IAAI;AACf,mBAAW,MAAM,OAAO,OAAO,CAAC;AAAA,MACnC,OAAS;AACN,mBAAW,MAAM,KAAK,IAAI,GAAG;AAAA,MAC7B;AAAA,IACD;AAYD,UAAM,eAAe,YAAY;AAChC,UAAI,CAAC,WAAW,MAAM,QAAQ;AAC7B,eAAOC,cAAAA,MAAI,UAAU;AAAA,UACpB,OAAO;AAAA,UACP,MAAM;AAAA,QACV,CAAI;AAAA,MACD;AAEDA,oBAAAA,MAAI,UAAU;AAAA,QACb,OAAO;AAAA,QACP,SAAS,QAAQ,WAAW,MAAM,MAAM;AAAA,QACxC,SAAS,OAAO,QAAQ;;AACvB,cAAI,CAAC,IAAI;AAAS;AAElBA,wBAAAA,MAAI,YAAY;AAAA,YACf,OAAO;AAAA,UACZ,CAAK;AACD,cAAI;AACH,kBAAM,SAAS,MAAMC,cAAQ,GAAC,aAAa;AAAA,cAC1C,MAAM;AAAA,cACN,MAAM;AAAA,gBACL,KAAK,WAAW;AAAA,cAChB;AAAA,YACP,CAAM;AAED,kBAAI,YAAO,WAAP,mBAAe,UAAS,KAAK;AAChCD,4BAAAA,MAAI,UAAU;AAAA,gBACb,OAAO;AAAA,cACd,CAAO;AACD,yBAAW,QAAQ,CAAE;AACrB,2BAAc;AAAA,YACpB,OAAY;AACNA,4BAAAA,MAAI,UAAU;AAAA,gBACb,SAAO,YAAO,WAAP,mBAAe,QAAO;AAAA,gBAC7B,MAAM;AAAA,cACb,CAAO;AAAA,YACD;AAAA,UACD,SAAQ,GAAG;AACXA,0BAAAA,MAAI,UAAU;AAAA,cACb,OAAO;AAAA,cACP,MAAM;AAAA,YACZ,CAAM;AAAA,UACN,UAAc;AACTA,0BAAAA,MAAI,YAAa;AAAA,UACjB;AAAA,QACD;AAAA,MACJ,CAAG;AAAA,IACD;AAGD,UAAM,eAAe,YAAY;;AAChCA,oBAAAA,MAAI,YAAY;AAAA,QACf,OAAO;AAAA,MACV,CAAG;AACD,UAAI;AACH,cAAM,MAAM,MAAMC,cAAQ,GAAC,aAAa;AAAA,UACvC,MAAM;AAAA,UACN,MAAM;AAAA,YACL,gBAAgB;AAAA,YAChB,MAAM;AAAA,YACN,UAAU;AAAA,YACV,SAAS;AAAA,cACR,CAAC,eAAe,MAAM;AAAA,YACtB;AAAA,UACD;AAAA,QACL,CAAI;AACD,kBAAU,UAAQ,SAAI,WAAJ,mBAAY,SAAQ,CAAE;AAAA,MACxC,SAAQ,GAAG;AACXD,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QACV,CAAI;AAAA,MACJ,UAAY;AACTA,sBAAAA,MAAI,YAAa;AAAA,MACjB;AAAA,IACD;AAEDE,kBAAAA,UAAU,YAAY;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxJvB,GAAG,WAAW,eAAe;"}